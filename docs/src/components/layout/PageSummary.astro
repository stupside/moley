---
import type { PageDefinition } from "../../types/content.js";
import { traverseContent } from "../../utils/content.js";

export interface Props {
	page: PageDefinition;
}

const { page } = Astro.props;

// Use traverseContent utility to find all headings
const headings = traverseContent(page.content, (block) => {
	if (block.type === "heading" && "depth" in block) {
		return block.depth;
	}
	return null;
});

// Use traverseContent utility to find all code blocks
const codeBlocks = traverseContent(page.content, (block) => {
	if (block.type === "codeblock" && "language" in block) {
		return block.language;
	}
	return null;
});

// Get unique languages
const uniqueLanguages = [...new Set(codeBlocks)];

// Count sections
const sectionCount = traverseContent(page.content, (block) => {
	return block.type === "section" ? 1 : null;
}).length;
---

{(headings.length > 0 || uniqueLanguages.length > 0 || sectionCount > 0) && (
  <div class="bg-gray-50 rounded-lg p-4 text-sm text-gray-600">
    <div class="flex flex-col gap-2">
      <h3 class="font-medium text-gray-900">Page Summary</h3>
      <ul class="space-y-1">
        {headings.length > 0 && (
          <li>{headings.length} heading{headings.length !== 1 ? 's' : ''}</li>
        )}
        {sectionCount > 0 && (
          <li>{sectionCount} section{sectionCount !== 1 ? 's' : ''}</li>
        )}
        {uniqueLanguages.length > 0 && (
          <li>Code examples in: {uniqueLanguages.join(', ')}</li>
        )}
      </ul>
    </div>
  </div>
)}